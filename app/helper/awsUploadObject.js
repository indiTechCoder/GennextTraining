var Busboy = require('busboy');var fs = require('fs');var config = require('../../config/config');var AWS = require('aws-sdk');var uuid = require('node-uuid');var mime = require('mime');AWS.config.region = config.awsConfig.region;var credentials = new AWS.SharedIniFileCredentials({    profile: 'default'});AWS.config.credentials = credentials;AWS.config.update({ accessKeyId: config.awsConfig.accessKeyId, secretAccessKey: config.awsConfig.secretAccessKey});//ubmas.com//elasticbeanstalk-us-west-2-451112350788function doUpload(req, res, next) {        if (!config.useS3) {        return next();    }  if (req.method === 'POST') {      var busboy = new Busboy({ headers: req.headers });    console.time("upload");    busboy.on('file', function(fieldname, file, filename, encoding, mimetype) {            filename = uuid.v4() + '.' + mime.extension(mimetype);            var s3obj = new AWS.S3({ params: { Bucket: config.awsConfig.bucket, Key: filename, ACL: config.awsConfig.ACL } });                        s3obj.createBucket(function () {                s3obj.upload({ Body: file })                      .on('httpUploadProgress', function (evt) {                            console.log(evt);                        })                      .send(function (err, data) {                        req.fileData = data;                        console.log(err, data);                        next();                });            });     	    console.log('File [' + fieldname + ']: filename: ' + filename + ', encoding: ' + encoding + ', mimetype: ' + mimetype);            /*file.on('data', function(data) {        console.log('File [' + fieldname + '] got ' + data.length + ' bytes');      });            file.on('end', function() {        console.log('File [' + fieldname + '] Finished');      });*/    });    busboy.on('field', function(fieldname, val, fieldnameTruncated, valTruncated, encoding, mimetype) {            req.body[fieldname] = val;    });    busboy.on('finish', function() {            console.log('Done parsing form!');            console.timeEnd("upload");     });    req.pipe(busboy);  }}function lunchEMRCluster(req, res){	}exports.doUpload=doUpload;